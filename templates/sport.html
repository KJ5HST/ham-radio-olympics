{% extends "base.html" %}

{% block title %}{{ sport.name }} - Ham Radio Olympics{% endblock %}

{% block content %}
<h2>{{ sport.name }}</h2>

{% if sport.description %}
<p>{{ sport.description }}</p>
{% endif %}

<div class="card">
    <p><strong>Target Type:</strong> {{ sport.target_type | title }}</p>
    <p><strong>Modes:</strong>
        {% if sport.work_enabled %}Work{% endif %}
        {% if sport.work_enabled and sport.activate_enabled %} / {% endif %}
        {% if sport.activate_enabled %}Activate{% endif %}
    </p>
    {% if sport.separate_pools %}
    <p><em>Work and Activate have separate medal pools</em></p>
    {% endif %}
    <p><strong>Participants:</strong> {{ entry_count }}</p>
    {% if user %}
    <div style="margin-top: 10px;">
        {% if is_entered %}
        <span style="color: #38a169; font-weight: bold;">You are entered in this sport</span>
        <button onclick="leaveSport()" class="btn btn-danger" style="margin-left: 10px;">Leave Sport</button>
        {% else %}
        <button onclick="enterSport()" class="btn" style="background: #38a169;">Participate</button>
        {% endif %}
    </div>
    {% endif %}
</div>

<script>
async function enterSport() {
    const resp = await fetch('/sport/{{ sport.id }}/enter', {method: 'POST'});
    if (resp.ok) {
        location.reload();
    } else {
        showToast('Failed to enter sport', 'error');
    }
}

async function leaveSport() {
    if (!confirm('Leave this sport? You can re-enter later.')) return;
    const resp = await fetch('/sport/{{ sport.id }}/leave', {method: 'POST'});
    if (resp.ok) {
        location.reload();
    } else {
        showToast('Failed to leave sport', 'error');
    }
}
</script>

{% if standings %}
<h3>Overall Standings</h3>
<div class="table-responsive"><table>
    <thead>
        <tr>
            <th scope="col">Rank</th>
            <th scope="col">Callsign</th>
            <th scope="col">Gold</th>
            <th scope="col">Silver</th>
            <th scope="col">Bronze</th>
            <th scope="col">Points</th>
        </tr>
    </thead>
    <tbody>
        {% for standing in standings[:20] %}
        <tr>
            <td>{{ loop.index }}</td>
            <td><a href="/competitor/{{ standing.callsign }}">{{ standing.callsign }}</a></td>
            <td class="medal-gold">{{ standing.gold }}</td>
            <td class="medal-silver">{{ standing.silver }}</td>
            <td class="medal-bronze">{{ standing.bronze }}</td>
            <td><strong>{{ standing.total_points }}</strong></td>
        </tr>
        {% endfor %}
    </tbody>
</table></div>
{% else %}
<div class="card">
    <p>No standings yet. Medals are awarded as matches complete.</p>
</div>
{% endif %}

{% if matches %}
<h3>Matches</h3>
<div class="table-responsive"><table>
    <thead>
        <tr>
            <th scope="col">Target</th>
            <th scope="col">Start Date</th>
            <th scope="col">End Date</th>
            <th scope="col">Action</th>
        </tr>
    </thead>
    <tbody>
        {% for match in matches %}
        <tr>
            <td><strong>{{ match.target_display }}</strong></td>
            <td>{{ match.start_date | format_date }}</td>
            <td>{{ match.end_date | format_date }}</td>
            <td><a href="/olympiad/sport/{{ sport.id }}/match/{{ match.id }}" class="btn">View</a></td>
        </tr>
        {% endfor %}
    </tbody>
</table></div>
{% else %}
<div class="card">
    <p>No matches scheduled yet.</p>
</div>
{% endif %}

<p><a href="/">Back to Home</a></p>
{% endblock %}
