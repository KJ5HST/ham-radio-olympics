{% extends "base.html" %}

{% block title %}{{ competitor.callsign }} - Ham Radio Olympics{% endblock %}

{% block nav_extra %}{% endblock %}

{% block content %}
{% if is_own_profile %}
<h2>Welcome, {{ competitor.first_name | competitor_display(competitor.callsign) }}</h2>
{% else %}
<h2>{{ competitor.first_name | competitor_display(competitor.callsign) }}</h2>
{% endif %}

<div class="stats">
    <a href="#medals-section" class="stat-box" style="text-decoration: none; color: inherit;">
        <div class="value">ü•á <span class="medal-gold">{{ medal_summary.gold }}</span></div>
        <div class="label">Gold</div>
    </a>
    <a href="#medals-section" class="stat-box" style="text-decoration: none; color: inherit;">
        <div class="value">ü•à <span class="medal-silver">{{ medal_summary.silver }}</span></div>
        <div class="label">Silver</div>
    </a>
    <a href="#medals-section" class="stat-box" style="text-decoration: none; color: inherit;">
        <div class="value">ü•â <span class="medal-bronze">{{ medal_summary.bronze }}</span></div>
        <div class="label">Bronze</div>
    </a>
    <a href="#medals-section" class="stat-box" style="text-decoration: none; color: inherit;">
        <div class="value">{{ medal_summary.total_points }}</div>
        <div class="label">Points</div>
    </a>
</div>

<div class="card">
    <h4>Account Status</h4>
    <p><strong>Registered:</strong> {{ competitor.registered_at | format_date if competitor.registered_at else '-' }}</p>
    {% if is_own_profile %}
    <p><strong>QRZ API Key:</strong> {% if user.has_qrz_key %}Stored{% else %}<span style="color: #718096;">Not stored</span>{% endif %}</p>
    <p><strong>LoTW Credentials:</strong> {% if user.has_lotw_creds %}Stored{% else %}<span style="color: #718096;">Not stored</span>{% endif %}</p>
    {% endif %}
    <p><strong>Last Sync:</strong> {{ competitor.last_sync_at | format_datetime(competitor.home_grid, competitor.time_display) if competitor.last_sync_at else 'Never' }}</p>
    {% if is_own_profile %}
    <div style="margin-top: 15px;">
        <strong>Sync QSOs:</strong>
        <div style="display: flex; gap: 10px; margin-top: 8px; flex-wrap: wrap;">
            {% if user.has_qrz_key %}
            <button onclick="syncQrzStored()" id="sync-qrz-btn" class="btn"><span class="icon">üîÑ</span> Sync from QRZ</button>
            {% else %}
            <button onclick="showQrzModal()" id="sync-qrz-btn" class="btn"><span class="icon">üîÑ</span> Sync from QRZ</button>
            {% endif %}
            {% if user.has_lotw_creds %}
            <button onclick="syncLotwStored()" id="sync-lotw-btn" class="btn btn-purple"><span class="icon">üîÑ</span> Sync from LoTW</button>
            {% else %}
            <button onclick="showLotwModal()" id="sync-lotw-btn" class="btn btn-purple"><span class="icon">üîÑ</span> Sync from LoTW</button>
            {% endif %}
        </div>
        <p style="margin-top: 10px; font-size: 0.9em; color: #718096;">
            <a href="/settings">Manage stored credentials</a>
        </p>
    </div>

    <!-- QRZ Modal -->
    <div id="qrz-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 25px; border-radius: 8px; max-width: 400px; width: 90%; margin: 20px;">
            <h4 style="margin-top: 0;">Sync from QRZ</h4>
            <p style="color: #718096; font-size: 0.9em;">Enter your QRZ API key to sync your QSOs.</p>
            <div class="form-group">
                <label for="qrz-api-key">QRZ API Key</label>
                <input type="text" id="qrz-api-key" placeholder="XXXX-XXXX-XXXX-XXXX">
            </div>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button onclick="syncQrz()" id="qrz-submit-btn" class="btn btn-success" style="flex: 1;"><span class="icon">üîÑ</span> Sync</button>
                <button onclick="hideQrzModal()" class="btn btn-secondary" style="flex: 1;"><span class="icon">‚úï</span> Cancel</button>
            </div>
            <div id="qrz-result" style="margin-top: 10px;"></div>
        </div>
    </div>

    <!-- LoTW Modal -->
    <div id="lotw-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 25px; border-radius: 8px; max-width: 400px; width: 90%; margin: 20px;">
            <h4 style="margin-top: 0;">Sync from LoTW</h4>
            <p style="color: #718096; font-size: 0.9em;">Enter your LoTW credentials to sync your QSOs.</p>
            <div class="form-group">
                <label for="lotw-username">LoTW Username</label>
                <input type="text" id="lotw-username" placeholder="Your callsign" value="{{ competitor.callsign }}">
            </div>
            <div class="form-group">
                <label for="lotw-password">LoTW Password</label>
                <input type="password" id="lotw-password" placeholder="Your LoTW password">
            </div>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button onclick="syncLotw()" id="lotw-submit-btn" class="btn btn-success" style="flex: 1;"><span class="icon">üîÑ</span> Sync</button>
                <button onclick="hideLotwModal()" class="btn btn-secondary" style="flex: 1;"><span class="icon">‚úï</span> Cancel</button>
            </div>
            <div id="lotw-result" style="margin-top: 10px;"></div>
        </div>
    </div>

    <script>
    // Format sync result message
    function formatSyncResult(data) {
        if (data.message) return data.message;
        const parts = [];
        if (data.new_qsos > 0) parts.push(data.new_qsos + ' new');
        if (data.updated_qsos > 0) parts.push(data.updated_qsos + ' updated');
        if (parts.length === 0) return 'QSOs synced successfully';
        return 'Synced ' + data.total_fetched + ' QSOs (' + parts.join(', ') + ')';
    }

    // QRZ sync with stored credentials
    async function syncQrzStored() {
        const btn = document.getElementById('sync-qrz-btn');
        setButtonLoading(btn, true);
        try {
            const resp = await fetch('/sync?callsign={{ competitor.callsign }}', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                credentials: 'same-origin'
            });
            const data = await resp.json();
            if (!resp.ok) {
                showToast('Sync failed: ' + (data.detail || 'Unknown error'), 'error');
                setButtonLoading(btn, false);
            } else {
                showToast(formatSyncResult(data), 'success');
                setTimeout(() => location.reload(), 1500);
            }
        } catch (e) {
            setButtonLoading(btn, false);
            showToast('Sync failed. Please try again.', 'error');
        }
    }

    // LoTW sync with stored credentials
    async function syncLotwStored() {
        const btn = document.getElementById('sync-lotw-btn');
        setButtonLoading(btn, true);
        try {
            const resp = await fetch('/sync/lotw/stored', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                credentials: 'same-origin'
            });
            const data = await resp.json();
            if (!resp.ok) {
                showToast('Sync failed: ' + (data.detail || 'Unknown error'), 'error');
                setButtonLoading(btn, false);
            } else {
                showToast(formatSyncResult(data), 'success');
                setTimeout(() => location.reload(), 1500);
            }
        } catch (e) {
            setButtonLoading(btn, false);
            showToast('Sync failed. Please try again.', 'error');
        }
    }

    // QRZ modal functions
    function showQrzModal() {
        document.getElementById('qrz-modal').style.display = 'flex';
        document.getElementById('qrz-api-key').focus();
    }

    function hideQrzModal() {
        document.getElementById('qrz-modal').style.display = 'none';
        document.getElementById('qrz-api-key').value = '';
        document.getElementById('qrz-result').innerHTML = '';
    }

    async function syncQrz() {
        const btn = document.getElementById('qrz-submit-btn');
        const result = document.getElementById('qrz-result');
        const apiKey = document.getElementById('qrz-api-key').value;

        if (!apiKey) {
            result.innerHTML = '<div class="alert alert-error">Please enter your QRZ API key</div>';
            return;
        }

        setButtonLoading(btn, true);
        result.innerHTML = '';

        try {
            const resp = await fetch('/sync/qrz', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({api_key: apiKey})
            });
            const data = await resp.json();
            if (resp.ok) {
                hideQrzModal();
                showToast(formatSyncResult(data), 'success');
                setTimeout(() => location.reload(), 1500);
            } else {
                result.innerHTML = '<div class="alert alert-error">' + (data.detail || 'Sync failed') + '</div>';
                setButtonLoading(btn, false);
            }
        } catch (e) {
            result.innerHTML = '<div class="alert alert-error">Sync failed: ' + e.message + '</div>';
            setButtonLoading(btn, false);
        }
    }

    // LoTW modal functions
    function showLotwModal() {
        document.getElementById('lotw-modal').style.display = 'flex';
        document.getElementById('lotw-password').focus();
    }

    function hideLotwModal() {
        document.getElementById('lotw-modal').style.display = 'none';
        document.getElementById('lotw-password').value = '';
        document.getElementById('lotw-result').innerHTML = '';
    }

    async function syncLotw() {
        const btn = document.getElementById('lotw-submit-btn');
        const result = document.getElementById('lotw-result');
        const username = document.getElementById('lotw-username').value;
        const password = document.getElementById('lotw-password').value;

        if (!username || !password) {
            result.innerHTML = '<div class="alert alert-error">Please enter both username and password</div>';
            return;
        }

        setButtonLoading(btn, true);
        result.innerHTML = '';

        try {
            const resp = await fetch('/sync/lotw', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username: username, password: password})
            });
            const data = await resp.json();
            if (resp.ok) {
                hideLotwModal();
                showToast(formatSyncResult(data), 'success');
                setTimeout(() => location.reload(), 1500);
            } else {
                result.innerHTML = '<div class="alert alert-error">' + (data.detail || 'Sync failed') + '</div>';
                setButtonLoading(btn, false);
            }
        } catch (e) {
            result.innerHTML = '<div class="alert alert-error">Sync failed: ' + e.message + '</div>';
            setButtonLoading(btn, false);
        }
    }

    // Close modals on escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            hideQrzModal();
            hideLotwModal();
        }
    });
    </script>
    {% endif %}
</div>

{% if is_own_profile %}
<h3>My Team</h3>
<div class="card" style="margin-bottom: 20px;">
    {% if user_team %}
    <p>
        <strong>Team:</strong> <a href="/team/{{ user_team.id }}">{{ user_team.name }}</a>
        {% if is_team_captain %}<span style="color: #718096;">(Captain)</span>{% endif %}
    </p>
    <p><strong>Members:</strong> {{ team_member_count }}</p>
    <div style="margin-top: 15px; display: flex; gap: 10px;">
        <a href="/team/{{ user_team.id }}" class="btn">View Team</a>
        {% if not is_team_captain %}
        <button type="button" class="btn" style="background: #c53030;" onclick="leaveTeam({{ user_team.id }})">Leave Team</button>
        {% endif %}
    </div>
    {% else %}
    <p>You are not on a team.</p>

    {% if pending_team_invites %}
    <h4 style="margin-top: 15px;">Pending Invites</h4>
    <table style="margin-bottom: 15px;">
        <thead>
            <tr>
                <th>Team</th>
                <th>Invited</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for inv in pending_team_invites %}
            <tr>
                <td><a href="/team/{{ inv.team_id }}">{{ inv.team_name }}</a></td>
                <td>{{ inv.created_at | format_date }}</td>
                <td>
                    <button type="button" class="btn btn-success" style="font-size: 0.8em; padding: 3px 8px;" onclick="acceptInvite({{ inv.team_id }})">Accept</button>
                    <button type="button" class="btn" style="font-size: 0.8em; padding: 3px 8px; background: #718096;" onclick="rejectInvite({{ inv.team_id }})">Decline</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}

    <div style="margin-top: 15px;">
        <a href="/teams" class="btn btn-success">Browse Teams</a>
    </div>
    {% endif %}
</div>

<script>
async function leaveTeam(teamId) {
    if (!confirm('Are you sure you want to leave this team?')) return;

    try {
        const resp = await fetch('/team/' + teamId + '/leave', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            credentials: 'same-origin'
        });
        const data = await resp.json();
        if (resp.ok) {
            window.location.reload();
        } else {
            showToast(data.detail || 'Failed to leave team', 'error');
        }
    } catch (err) {
        showToast('Network error', 'error');
    }
}

async function acceptInvite(teamId) {
    try {
        const resp = await fetch('/team/' + teamId + '/accept', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            credentials: 'same-origin'
        });
        const data = await resp.json();
        if (resp.ok) {
            showToast(data.message, 'success');
            window.location.reload();
        } else {
            showToast(data.detail || 'Failed to accept invite', 'error');
        }
    } catch (err) {
        showToast('Network error', 'error');
    }
}

async function rejectInvite(teamId) {
    if (!confirm('Decline this team invite?')) return;

    try {
        const resp = await fetch('/team/' + teamId + '/reject', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            credentials: 'same-origin'
        });
        const data = await resp.json();
        if (resp.ok) {
            showToast('Invite declined', 'success');
            window.location.reload();
        } else {
            showToast(data.detail || 'Failed to decline invite', 'error');
        }
    } catch (err) {
        showToast('Network error', 'error');
    }
}
</script>
{% endif %}

{% if sport_entries %}
<h3>{% if is_own_profile %}My {% endif %}Sports</h3>
<div class="table-responsive"><table>
    <thead>
        <tr>
            <th scope="col">Sport</th>
            <th scope="col">Olympiad</th>
            <th scope="col">Medals</th>
            <th scope="col">Points</th>
        </tr>
    </thead>
    <tbody>
        {% for sport in sport_entries %}
        <tr>
            <td><a href="/olympiad/sport/{{ sport.id }}"><strong>{{ sport.name }}</strong></a></td>
            <td>{{ sport.olympiad_name }}</td>
            <td>
                {% if sport.gold_count %}<span class="medal-count"><span class="gold">ü•á{{ sport.gold_count }}</span></span> {% endif %}
                {% if sport.silver_count %}<span class="medal-count"><span class="silver">ü•à{{ sport.silver_count }}</span></span> {% endif %}
                {% if sport.bronze_count %}<span class="medal-count"><span class="bronze">ü•â{{ sport.bronze_count }}</span></span> {% endif %}
                {% if not sport.gold_count and not sport.silver_count and not sport.bronze_count %}-{% endif %}
            </td>
            <td><strong>{{ sport.sport_points }}</strong></td>
        </tr>
        {% endfor %}
    </tbody>
</table></div>
{% endif %}

{% if personal_bests %}
<h3>Personal Bests (Competition)</h3>
<div class="table-responsive"><table>
    <thead>
        <tr>
            <th scope="col">Record Type</th>
            <th scope="col">Value</th>
            <th scope="col">Date</th>
        </tr>
    </thead>
    <tbody>
        {% for record in personal_bests %}
        <tr>
            <td>{{ record.record_type | replace('_', ' ') | title }}</td>
            <td>
                {% if 'distance' in record.record_type %}
                    {{ record.value | format_distance(competitor.distance_unit or 'km') }}
                {% elif 'cool_factor' in record.record_type %}
                    {% if competitor.distance_unit == 'mi' %}
                        {{ "%.1f" | format(record.value * 0.621371) }} mi/W
                    {% else %}
                        {{ "%.1f" | format(record.value) }} km/W
                    {% endif %}
                {% elif 'power' in record.record_type %}
                    {{ "%.1f" | format(record.value) }} W
                {% else %}
                    {{ record.value }}
                {% endif %}
            </td>
            <td>{{ record.achieved_at | format_datetime(competitor.home_grid, competitor.time_display) if record.achieved_at else '-' }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table></div>
{% endif %}

{% if alltime_bests %}
<h3>Personal Bests (All Time)</h3>
<div class="table-responsive"><table>
    <thead>
        <tr>
            <th scope="col">Record Type</th>
            <th scope="col">Value</th>
            <th scope="col">Contact</th>
            <th scope="col">Date</th>
        </tr>
    </thead>
    <tbody>
        {% for record in alltime_bests %}
        <tr>
            <td>{{ record.record_type | replace('_', ' ') | title }}</td>
            <td>
                {% if 'distance' in record.record_type %}
                    {{ record.value | format_distance(competitor.distance_unit or 'km') }}
                {% elif 'cool_factor' in record.record_type %}
                    {% if competitor.distance_unit == 'mi' %}
                        {{ "%.1f" | format(record.value * 0.621371) }} mi/W
                    {% else %}
                        {{ "%.1f" | format(record.value) }} km/W
                    {% endif %}
                {% elif 'power' in record.record_type %}
                    {{ "%.1f" | format(record.value) }} W
                {% else %}
                    {{ record.value }}
                {% endif %}
            </td>
            <td>{{ record.dx_callsign }}</td>
            <td>{{ record.achieved_at | format_datetime(competitor.home_grid, competitor.time_display) if record.achieved_at else '-' }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table></div>
{% endif %}

{% if medals %}
<h3 id="medals-section">{% if is_own_profile %}Recent {% endif %}Medals</h3>
<div class="table-responsive"><table>
    <thead>
        <tr>
            <th scope="col">Sport</th>
            <th scope="col">Target</th>
            <th scope="col">QSO Race</th>
            <th scope="col">Cool Factor</th>
            <th scope="col">Points</th>
            <th scope="col"></th>
        </tr>
    </thead>
    <tbody>
        {% for medal in medals[:10] %}
        <tr>
            <td><a href="/olympiad/sport/{{ medal.sport_id }}">{{ medal.sport_name }}</a></td>
            <td>{{ medal.target_display | pota_tooltip }}</td>
            <td>
                {% if medal.qso_race_medal %}
                    {% if medal.qso_race_medal == 'gold' %}ü•á{% elif medal.qso_race_medal == 'silver' %}ü•à{% elif medal.qso_race_medal == 'bronze' %}ü•â{% endif %}
                    {% if medal.qso_race_dx %}
                    <small style="color: var(--text-secondary);" title="QSO with {{ medal.qso_race_dx }} at {{ medal.qso_race_claim_time }}">{{ medal.qso_race_dx }}</small>
                    {% endif %}
                {% else %}
                    -
                {% endif %}
            </td>
            <td>
                {% if medal.cool_factor_medal %}
                    {% if medal.cool_factor_medal == 'gold' %}ü•á{% elif medal.cool_factor_medal == 'silver' %}ü•à{% elif medal.cool_factor_medal == 'bronze' %}ü•â{% endif %}
                    {% if medal.cool_factor_dx %}
                    <small style="color: var(--text-secondary);" title="QSO with {{ medal.cool_factor_dx }} (CF: {{ '%.1f' | format(medal.cool_factor_value) if medal.cool_factor_value else '-' }})">{{ medal.cool_factor_dx }}</small>
                    {% endif %}
                {% else %}
                    -
                {% endif %}
            </td>
            <td>{{ medal.total_points }}</td>
            <td><a href="/olympiad/sport/{{ medal.sport_id }}/match/{{ medal.match_id }}" class="btn btn-sm" title="View match details"><span class="icon">üëÅÔ∏è</span></a></td>
        </tr>
        {% endfor %}
    </tbody>
</table></div>
{% endif %}

<h3>{% if is_own_profile %}QSO Log{% else %}QSOs{% endif %}</h3>
<div class="card" style="margin-bottom: 15px;">
    <form method="get" style="display: flex; gap: 10px; flex-wrap: wrap; align-items: end;">
        <div class="form-group" style="margin-bottom: 0;">
            <label for="band">Band</label>
            <select id="band" name="band" style="min-width: 100px;">
                <option value="">All Bands</option>
                {% for b in ['160m', '80m', '60m', '40m', '30m', '20m', '17m', '15m', '12m', '10m', '6m', '2m', '70cm'] %}
                <option value="{{ b }}" {% if request.query_params.get('band') == b %}selected{% endif %}>{{ b }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group" style="margin-bottom: 0;">
            <label for="mode">Mode</label>
            <select id="mode" name="mode" style="min-width: 100px;">
                <option value="">All Modes</option>
                {% for m in ['SSB', 'CW', 'FT8', 'FT4', 'RTTY', 'PSK31', 'FM', 'AM', 'DIGI'] %}
                <option value="{{ m }}" {% if request.query_params.get('mode') == m %}selected{% endif %}>{{ m }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group" style="margin-bottom: 0;">
            <label for="confirmed">Status</label>
            <select id="confirmed" name="confirmed" style="min-width: 120px;">
                <option value="">All QSOs</option>
                <option value="1" {% if request.query_params.get('confirmed') == '1' %}selected{% endif %}>Confirmed</option>
                <option value="0" {% if request.query_params.get('confirmed') == '0' %}selected{% endif %}>Unconfirmed</option>
            </select>
        </div>
        <div class="btn-group">
            <button type="submit" class="btn"><span class="icon">üîç</span> Filter</button>
            {% if request.query_params.get('band') or request.query_params.get('mode') or request.query_params.get('confirmed') %}
            <a href="{{ request.url.path }}" class="btn btn-secondary"><span class="icon">‚úï</span> Clear</a>
            {% endif %}
        </div>
        {% if is_own_profile %}
        <div class="btn-group" style="margin-left: auto;">
            <a href="/export/qsos" class="btn btn-info"><span class="icon">üì•</span> Export QSOs</a>
            <a href="/export/medals" class="btn btn-info"><span class="icon">üì•</span> Export Medals</a>
        </div>
        {% endif %}
    </form>
</div>

{% if qsos %}
<div class="table-responsive"><table>
    <thead>
        <tr>
            <th scope="col">Date/Time (UTC)</th>
            <th scope="col">DX Call</th>
            <th scope="col">Band</th>
            <th scope="col">Mode</th>
            <th scope="col">Power</th>
            <th scope="col">QSO Race</th>
            <th scope="col">Cool Factor</th>
            <th scope="col">Confirmed</th>
        </tr>
    </thead>
    <tbody>
        {% for qso in qsos %}
        <tr>
            <td>{{ qso.qso_datetime_utc | format_time_local(competitor.home_grid, competitor.time_display or 'utc') }}</td>
            <td>
                <span class="dx-callsign" title="{{ qso.dx_country or '' }}">
                    {{ qso.dx_dxcc | country_flag }}
                    <strong>{{ qso.dx_callsign }}</strong>
                </span>
                {% if qso.dx_sig_info or qso.my_sig_info %}
                <span class="pota-badge">üèïÔ∏è {{ (qso.dx_sig_info or qso.my_sig_info) | pota_tooltip }}</span>
                {% endif %}
            </td>
            <td>{{ qso.band or '-' }}</td>
            <td>{{ qso.mode or '-' }}</td>
            <td>{% if qso.tx_power_w %}{{ qso.tx_power_w }}W{% else %}-{% endif %}</td>
            <td>{{ qso.distance_km | format_distance(competitor.distance_unit or 'km') if qso.distance_km else '-' }}</td>
            <td>{{ "%.1f" | format(qso.cool_factor) if qso.cool_factor else '-' }}</td>
            <td>{% if qso.is_confirmed %}Yes{% else %}No{% endif %}</td>
        </tr>
        {% endfor %}
    </tbody>
</table></div>

{% if pagination %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; flex-wrap: wrap; gap: 10px;">
    <span style="color: var(--text-secondary);">
        Showing {{ (pagination.page - 1) * pagination.per_page + 1 }}-{{ [pagination.page * pagination.per_page, pagination.total_items] | min }} of {{ pagination.total_items }} QSOs
    </span>
    {% if pagination.total_pages > 1 %}
    <div class="btn-group">
        {% if pagination.page > 1 %}
        <a href="?{% if request.query_params.get('band') %}band={{ request.query_params.get('band') }}&{% endif %}{% if request.query_params.get('mode') %}mode={{ request.query_params.get('mode') }}&{% endif %}{% if request.query_params.get('confirmed') %}confirmed={{ request.query_params.get('confirmed') }}&{% endif %}page={{ pagination.page - 1 }}" class="btn btn-sm btn-secondary">&larr; Prev</a>
        {% endif %}
        <span class="btn btn-sm" style="cursor: default;">Page {{ pagination.page }} of {{ pagination.total_pages }}</span>
        {% if pagination.page < pagination.total_pages %}
        <a href="?{% if request.query_params.get('band') %}band={{ request.query_params.get('band') }}&{% endif %}{% if request.query_params.get('mode') %}mode={{ request.query_params.get('mode') }}&{% endif %}{% if request.query_params.get('confirmed') %}confirmed={{ request.query_params.get('confirmed') }}&{% endif %}page={{ pagination.page + 1 }}" class="btn btn-sm btn-secondary">Next &rarr;</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="card">
    {% if is_own_profile %}
    <p>No QSOs synced yet. Use the sync buttons above to import your contacts from QRZ or LoTW.</p>
    {% else %}
    <p>No QSOs recorded for this competitor.</p>
    {% endif %}
</div>
{% endif %}
{% endblock %}
