{% extends "base.html" %}

{% block content %}
{% if olympiad %}
<h2>{{ olympiad.name }}</h2>
<p><strong>Period:</strong> {{ olympiad.start_date | format_date }} to {{ olympiad.end_date | format_date }}</p>
<p><strong>Minimum QSOs to Qualify:</strong> {% if olympiad.qualifying_qsos == 0 %}None (any confirmed QSO qualifies){% else %}{{ olympiad.qualifying_qsos }}{% endif %}</p>

<h3>Sports</h3>
{% if sports %}
<div class="table-responsive"><table>
    <thead>
        <tr>
            <th scope="col">Sport</th>
            <th scope="col">Target Type</th>
            <th scope="col">Modes</th>
            <th scope="col"></th>
        </tr>
    </thead>
    <tbody>
        {% for sport in sports %}
        <tr class="sport-row" onclick="toggleMatches({{ sport.id }})" style="cursor: pointer;">
            <td>
                <span class="expand-icon" id="expand-icon-{{ sport.id }}">‚ñ∂</span>
                <strong>{{ sport.name }}</strong>
                {% if sport.matches %}<span style="color: var(--text-secondary); font-size: 0.85em;"> ({{ sport.matches | length }} matches)</span>{% endif %}
            </td>
            <td>{{ sport.target_type | capitalize }}</td>
            <td>
                {% if sport.work_enabled %}Work{% endif %}
                {% if sport.work_enabled and sport.activate_enabled %} / {% endif %}
                {% if sport.activate_enabled %}Activate{% endif %}
                {% if sport.separate_pools %} (separate pools){% endif %}
            </td>
            <td><a href="/olympiad/sport/{{ sport.id }}" class="btn btn-sm" onclick="event.stopPropagation();"><span class="icon">üëÅÔ∏è</span> View</a></td>
        </tr>
        <tr class="details-row" id="matches-{{ sport.id }}" style="display: none;">
            <td colspan="4" style="padding: 0; background: var(--bg-primary);">
                {% if sport.matches %}
                <table style="margin: 10px; width: calc(100% - 20px);">
                    <thead>
                        <tr>
                            <th>Target</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for match in sport.matches %}
                        <tr>
                            <td>{{ match.target_display }}</td>
                            <td>{{ match.start_date | format_date }}</td>
                            <td>{{ match.end_date | format_date }}</td>
                            <td><a href="/olympiad/sport/{{ sport.id }}/match/{{ match.id }}" class="btn btn-sm"><span class="icon">üëÅÔ∏è</span></a></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p style="margin: 10px; color: var(--text-secondary);">No matches scheduled yet.</p>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table></div>

<script>
function toggleMatches(sportId) {
    var row = document.getElementById('matches-' + sportId);
    var icon = document.getElementById('expand-icon-' + sportId);
    if (row.style.display === 'none') {
        row.style.display = 'table-row';
        icon.textContent = '‚ñº';
    } else {
        row.style.display = 'none';
        icon.textContent = '‚ñ∂';
    }
}
</script>
{% else %}
<p>No sports configured yet.</p>
{% endif %}

{% else %}
<h2>No Active Olympiad</h2>
<p>There is currently no active competition. Check back later!</p>
{% endif %}
{% endblock %}
